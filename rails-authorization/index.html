<!DOCTYPE html>
<html lang="en-US" prefix="og: http://ogp.me/ns#"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1"><title>4. Ruby on Rails Authorization - Mediocre Inventions</title><meta name="description" content="In this part of the tutorial, we will implement authorization in our Ruby on Rails application with the Rolify and CanCanCan gems."><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="og:title" content="4. Ruby on Rails Authorization - Mediocre Inventions"><meta property="og:description" content="In this part of the tutorial, we will implement authorization in our Ruby on Rails application with the Rolify and CanCanCan gems."><meta property="og:url" content="https://www.mediocreinventions.com/rails-authorization/"><meta property="og:site_name" content="Mediocre Inventions"><meta property="article:tag" content="Authorization"><meta property="article:tag" content="CanCanCan"><meta property="article:tag" content="Rolify"><meta property="article:tag" content="Ruby"><meta property="article:tag" content="Ruby on Rails"><meta property="article:section" content="Rails and React To Production (Nginx)"><meta property="article:published_time" content="2018-12-30T03:08:52+00:00"><meta property="article:modified_time" content="2018-12-31T21:27:32+00:00"><meta property="og:updated_time" content="2018-12-31T21:27:32+00:00"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:description" content="In this part of the tutorial, we will implement authorization in our Ruby on Rails application with the Rolify and CanCanCan gems."><meta name="twitter:title" content="4. Ruby on Rails Authorization - Mediocre Inventions"><link rel="dns-prefetch" href="//fonts.googleapis.com"><link rel="dns-prefetch" href="//s.w.org"><link rel="stylesheet" id="wp-block-library-css" href="https://www.mediocreinventions.com/wp-includes/css/dist/block-library/style.min.css" type="text/css" media="all"><link rel="stylesheet" id="wp-block-library-theme-css" href="https://www.mediocreinventions.com/wp-includes/css/dist/block-library/theme.min.css" type="text/css" media="all"><link rel="stylesheet" id="blog-bank-font-css" href="https://fonts.googleapis.com/css?family=Montserrat%3A400%2C700%7CPoppins%3A300%2C400%7Cfamily%3DSlabo%2B27px%3A300%2C400%2C700&amp;subset=latin%2Clatin-ext" type="text/css" media="all"><link rel="stylesheet" id="bootstrap-css" href="https://www.mediocreinventions.com/wp-content/themes/blog-bank/assets/css/bootstrap.min.css" type="text/css" media="all"><link rel="stylesheet" id="animate-css" href="https://www.mediocreinventions.com/wp-content/themes/blog-bank/assets/css/animate.css" type="text/css" media="all"><link rel="stylesheet" id="owl.carousel-css" href="https://www.mediocreinventions.com/wp-content/themes/blog-bank/assets/css/owl.carousel.min.css" type="text/css" media="all"><link rel="stylesheet" id="material-design-iconic-font-css" href="https://www.mediocreinventions.com/wp-content/themes/blog-bank/assets/css/material-design-iconic-font.min.css" type="text/css" media="all"><link rel="stylesheet" id="font-awesome-css" href="https://www.mediocreinventions.com/wp-content/themes/blog-bank/assets/css/font-awesome.min.css" type="text/css" media="all"><link rel="stylesheet" id="blog-bank-default-css" href="https://www.mediocreinventions.com/wp-content/themes/blog-bank/assets/css/default.css" type="text/css" media="all"><link rel="stylesheet" id="blog-bank-style-css" href="https://www.mediocreinventions.com/wp-content/themes/blog-bank/style.css" type="text/css" media="all"><link rel="stylesheet" id="block-style-css" href="https://www.mediocreinventions.com/wp-content/themes/blog-bank/assets/css/block.css" type="text/css" media="all"><link rel="stylesheet" id="blog-bank-responsive-css" href="https://www.mediocreinventions.com/wp-content/themes/blog-bank/assets/css/responsive.css" type="text/css" media="all"><script type="text/javascript" src="https://www.mediocreinventions.com/wp-content/themes/blog-bank/assets/js/vendor/modernizr-2.8.3.min.js"></script><script type="text/javascript" src="https://www.mediocreinventions.com/wp-includes/js/jquery/jquery.js"></script><script type="text/javascript" src="https://www.mediocreinventions.com/wp-includes/js/jquery/jquery-migrate.min.js"></script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-108237564-4"></script><script>
			window.dataLayer = window.dataLayer || [];
			function gtag(){dataLayer.push(arguments);}
			gtag('js', new Date());
			gtag('config', 'UA-108237564-4');
			
		</script></head><body class="post-template-default single single-post postid-721 single-format-standard">
<div id="page" class="site">
	<a class="skip-link screen-reader-text" href="#content">Skip to content</a>
	  
	      
        <header id="site-head"><nav id="mainNav" class="navbar navbar-default navbar-custom navbar-fixed-top gold-nav"><div class="container">
                    
                    <div class="navbar-header page-scroll">
                        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main_menu">
                            <span class="sr-only">Toggle navigation</span> Menu <i class="fa fa-bars"></i>
                        </button>
                        				<h1 class="site-title"><a href="https://www.mediocreinventions.com/" rel="home">Mediocre Inventions</a></h1>
			                        
                    </div>
                    
                                  
                </div>
                
            </nav></header><div id="content" class="site-content">

	<section class="entry-content section-padding"><div class="container"> 
        	<div class="row"> 
            	<div class="col-sm-9">

				<article id="post-721" class="single-content post-text scroll post-721 post type-post status-publish format-standard hentry category-rails-to-production category-rails-authentication-authorization tag-authorization tag-cancancan tag-rolify tag-ruby tag-ruby-on-rails"><div class=" content-media"> 
                            	                            </div>
                            <header class=" text-header"><h2>4. Ruby on Rails Authorization</h2>                                                            <div class="post-meta"> 
                                   <a href="https://www.mediocreinventions.com/author/mt9304gmail-com/"><span class="post-author"><i class="zmdi zmdi-account-circle"> Admin</i></span></a>
                                                                       <span class="post-cat"><i class="fa fa-book"></i> <a href="https://www.mediocreinventions.com/category/rails-to-production/" rel="category tag">Rails and React To Production (Nginx)</a>, <a href="https://www.mediocreinventions.com/category/rails-to-production/rails-authentication-authorization/" rel="category tag">Rails Authentication/Authorization</a></span>
                                                                   
                                </div>
                                                        </header><div class=" ufade post-content"> 
                               	<div class="entry-content">
									
<h2>Intro</h2>



<p>In this
 article, we will create two roles for the users: the Admin role and 
Normal_User role. Users with the Admin role should have access to create
 and modify books on the website, while normal_users should only be able
 to view the books. </p>



<p>We use the Rolify and CanCanCan gems to help us implement authorization. To start this, go into the console and type: </p>



<pre class="wp-block-preformatted">rails g rolify Role User
rails generate cancan:ability
rake db:migrate
</pre>



<h2>Roles</h2>



<p>Then go into /app/models/Roles.rb and make sure that it looks like this: <a rel="noreferrer noopener" href="https://gist.github.com/mt9304/ef8fd420d43ecdd442e9c418c6667243" target="_blank">https://gist.github.com/mt9304/ef8fd420d43ecdd442e9c418c6667243</a><br><br></p>
<script src="https://gist.github.com/mt9304/ef8fd420d43ecdd442e9c418c6667243.js"></script><p>Now we can go into our /db/seeds.rb file and add some roles, books, and sample users. </p>



<p></p><p>The seeds.rb file should look like this: <a href="https://gist.github.com/mt9304/c67f4e862fedfaa01c47e9934f5663c9" target="_blank" rel="noreferrer noopener">https://gist.github.com/mt9304/c67f4e862fedfaa01c47e9934f5663c9</a></p>
<script src="https://gist.github.com/mt9304/c67f4e862fedfaa01c47e9934f5663c9.js"></script><p>Let&rsquo;s erase our database and start fresh by typing: </p>



<pre class="wp-block-preformatted">rake db:drop db:create db:migrate
</pre>



<p>We can then run the commands in the seeds.rb file by going into our terminal and typing: </p>



<pre class="wp-block-preformatted">rake db:seed
</pre>



<p><strong>Note: </strong></p>



<p>The seeds.rb file are 
just a list of database related actions that you want to perform to fill
 up the database with default items. This way you don&rsquo;t have to go into 
the Rails console or database to manually enter values each time you 
want to reset your database. In this seeds file, we created 2 roles, 2 
users, and made a loop that created 5 sample book entries. </p>



<h4>Opening the Database<br></h4>



<p>You can check to see if these values were entered into the database successfuly by running the following command to open your database: </p>



<pre class="wp-block-preformatted">sqlitebrowser db/development.sqlite3
</pre>



<p>To browse a table, right click on it and click on 
Browse Table. The books table should have 5 entries, Roles should have 
2, Users 2, and User_Roles. </p>



<p><strong>Note:</strong></p>



<p>The
 &lsquo;roles&rsquo; table should include the roles that we created, admin and 
normal_user. Each of these should be associated with an id such as 1 and
 2. Each user in the &lsquo;users&rsquo; table should also have an id associated 
with it. The &lsquo;user_roles&rsquo; table should have a column called user_id and 
role_id. This is the table that lets the application know which users 
(their ids) are associated with which roles (their ids). In this case, 
it should say that User with an id of 1 (the admin user we created) 
should have the role with an id of 1 (the admin role).</p>



<h4>Authorization</h4>



<p>Now we can begin to implement authorization by permitting certain actions. Lets start by going into the /app/models/user.rb file and add some role checking functions: </p>



<pre class="wp-block-preformatted">def admin?
&nbsp;&nbsp;&nbsp;has_role?(:admin)
end

def normal_user?
&nbsp;&nbsp;&nbsp;has_role?(:normal_user)
end
</pre>



<p>The user.rb file should look like this: <a href="https://gist.github.com/mt9304/1d2e6a8bfeeb17719bc54320317b221f" target="_blank" rel="noreferrer noopener">https://gist.github.com/mt9304/1d2e6a8bfeeb17719bc54320317b221f</a></p>
<script src="https://gist.github.com/mt9304/1d2e6a8bfeeb17719bc54320317b221f.js"></script><p>These
 functions allow use to check if a user has a certain role. We can use 
this in the /app/models/ability.rb file which helps use define what each
 user can do on the site. Open up the ability.rb file and edit it so 
that it looks like this: <a href="https://gist.github.com/mt9304/f6aaa6e0b839aaf35450a85105728c14" target="_blank" rel="noreferrer noopener">https://gist.github.com/mt9304/f6aaa6e0b839aaf35450a85105728c14</a></p>
<script src="https://gist.github.com/mt9304/f6aaa6e0b839aaf35450a85105728c14.js"></script><p>In
 this case, we will allow users to view and create new books, admins can
 manage (create, delete, edit, read) everything, and unauthenticated 
users will only be able to read. For more information on defining 
abilities, please visit: <a href="https://github.com/CanCanCommunity/cancancan/wiki/Defining-Abilities" target="_blank" rel="noreferrer noopener">https://github.com/CanCanCommunity/cancancan/wiki/Defining-Abilities</a></p>



<h4>Controller</h4>



<p>Now we just have to go into our /app/controllers/api/books_controller.rb file to make sure our controller is checking for permissions before allowing any actions to be performed. At the top (under class BooksController and above the index method), add the following: </p>



<pre class="wp-block-preformatted">load_and_authorize_resource
before_action :authenticate_user!, except: [:index]
</pre>



<p>The controller should now look like this: <a href="https://gist.github.com/mt9304/f8deb96abb3acc0f64d30c47716143e5" target="_blank" rel="noreferrer noopener">https://gist.github.com/mt9304/f8deb96abb3acc0f64d30c47716143e5</a></p>
<script src="https://gist.github.com/mt9304/f8deb96abb3acc0f64d30c47716143e5.js"></script><p><strong>Note: </strong></p>



<p>The
 before_action line will direct users to the login screen if they try to
 access any method in the books controller except for :index. You can 
test this out by logging out and browsing to localhost:3000/api/books to
 see the list of books (this URL is the :index function). Now try to 
visit localhost:3000/api/books/1 (the :show function) and it should 
redirect you to the login page. Once you login, you should be able to 
see the particular book with 1 as the id. </p>



<p>After this, let&rsquo;s open up /app/controllers/application_controller.rb and add these lines into the class: </p>



<pre class="wp-block-preformatted">rescue_from CanCan::AccessDenied do |exception|
&nbsp;redirect_to root_url
end
</pre>



<p>This will redirect the user to the home page when 
they try to do something that their user role is not permitted to do. 
Now we have a basic authorization process for the website!</p>



<p><strong>Note: </strong></p>



<p>Right
 now we can test out the read/get functions like :index and :show, but 
we haven&rsquo;t went over the ways of put and post options (creating, 
deleting, or editing). We will implement these functions in the next 
article where we implement React for the front-end of the website. </p>
<div class="tags-links bfade">Tagged: <a href="https://www.mediocreinventions.com/tag/authorization/" rel="tag">Authorization</a>, <a href="https://www.mediocreinventions.com/tag/cancancan/" rel="tag">CanCanCan</a>, <a href="https://www.mediocreinventions.com/tag/rolify/" rel="tag">Rolify</a>, <a href="https://www.mediocreinventions.com/tag/ruby/" rel="tag">Ruby</a>, <a href="https://www.mediocreinventions.com/tag/ruby-on-rails/" rel="tag">Ruby on Rails</a></div>								</div>
                            </div>
        </article><nav class="navigation post-navigation" role="navigation"><h2 class="screen-reader-text">Post navigation</h2>
		<div class="nav-links"><div class="nav-previous"><a href="https://www.mediocreinventions.com/rails-authentication/" rel="prev">3. Ruby on Rails Authentication</a></div><div class="nav-next"><a href="https://www.mediocreinventions.com/rails-with-react/" rel="next">5. Ruby on Rails With React</a></div></div>
	</nav></div>
								<div class="col-sm-3"> 
				
<aside id="secondary" class="widget-area"><section id="search-2" class="widget widget_search"><form role="search" method="get" class="search-form" action="https://www.mediocreinventions.com/">
				<label>
					<span class="screen-reader-text">Search for:</span>
					<input type="search" class="search-field" placeholder="Search &hellip;" value="" name="s"></label>
				<input type="submit" class="search-submit" value="Search"></form></section><section id="recent-posts-2" class="widget widget_recent_entries"><h3 class="widget-title">Recent Tutorials</h3>		<ul><li>
					<a href="https://www.mediocreinventions.com/nginx-and-lets-encrypt-ssl/">8. Nginx and Let&rsquo;s Encrypt (SSL)</a>
									</li>
											<li>
					<a href="https://www.mediocreinventions.com/rails-on-nginx/">7. Rails on Nginx, Puma, and PostgreSQL</a>
									</li>
											<li>
					<a href="https://www.mediocreinventions.com/ruby-on-rails-hosting/">6. Ruby on Rails Hosting Options</a>
									</li>
					</ul></section><section id="categories-2" class="widget widget_categories"><h3 class="widget-title">Tutorials</h3>		<ul><li class="cat-item cat-item-9"><a href="https://www.mediocreinventions.com/category/rails-to-production/" title="A collection of tutorials on creating a Ruby on Rails (5.2) web application with React (16.2). These tutorials will walk through how to push the application into a Production environment. The Production environments can be Heroku or AWS with a Ubuntu 18.04 server using Nginx and Puma. Some articles will also cover how to monitor the application. ">Rails and React To Production (Nginx)</a>
<ul class="children"><li class="cat-item cat-item-281"><a href="https://www.mediocreinventions.com/category/rails-to-production/rails-authentication-authorization/" title="This portion of the tutorial is for building a simple Ruby on Rails application. It will use Rolify, CanCanCan, and Devise to implement authentication and authorization. ">Rails Authentication/Authorization</a>
</li>
	<li class="cat-item cat-item-2"><a href="https://www.mediocreinventions.com/category/rails-to-production/rails-react/" title="Tutorial for creating a React (16.2) website using Ruby on Rails (5.2). We will build an API using Rails and interact with it using AJAX to get our information. ">Ruby on Rails With React</a>
</li>
	<li class="cat-item cat-item-8"><a href="https://www.mediocreinventions.com/category/rails-to-production/rails-nginx/" title="A collection of tutorials on how to deploy a Ruby on Rails web application. We will be using Nginx and Puma on a Ubuntu 18.04 server to accomplish this. ">Ruby on Rails, Nginx and Puma</a>
</li>
</ul></li>
	<li class="cat-item cat-item-10"><a href="https://www.mediocreinventions.com/category/web-basics/" title="Before starting some of the tutorials on this website, it is recommended to review some of the topics here. This is to make sure you are familiar with the relevant concepts for this site. 
The articles in this category cover some of the basic topics that are relevant to web application development. These are brief articles that are meant to get you an idea of what to expect. 
You can read these in order starting from 1., but it is not necessary. Some of the tutorials later on will reference specific articles here if needed. 
">Web Application Basics</a>
</li>
		</ul></section></aside></div>
							</div>
		</div>
	</section></div>

        <footer class="footer-section"><div class="container"> 
                <div class="footer-bottom"> 
                    <div class="copy-text">
                    	<p>Mediocre Inventions | 2018</p>
                    </div>
                </div>
            </div>
        </footer></div>

<script type="text/javascript" src="https://www.mediocreinventions.com/wp-content/themes/blog-bank/assets/js/bootstrap.min.js"></script><script type="text/javascript" src="https://www.mediocreinventions.com/wp-content/themes/blog-bank/assets/js/plugins.js"></script><script type="text/javascript" src="https://www.mediocreinventions.com/wp-content/themes/blog-bank/assets/js/scrollreveal.min.js"></script><script type="text/javascript" src="https://www.mediocreinventions.com/wp-content/themes/blog-bank/assets/js/owl.carousel.min.js"></script><script type="text/javascript" src="https://www.mediocreinventions.com/wp-content/themes/blog-bank/assets/js/main.js"></script><script type="text/javascript" src="https://www.mediocreinventions.com/wp-content/themes/blog-bank/assets/js/skip-link-focus-fix.js"></script></body></html>
